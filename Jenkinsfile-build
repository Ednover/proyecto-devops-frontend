pipeline{
    agent{ label 'agent1'}
    stages{
        stage('Build'){
        steps{
            sh 'npm install'
            sh 'npm run build'
        }
    }
        stage('Publish on VM'){
            steps{
                sshPublisher(
                    publishers: [
                        sshPublisherDesc(
                            configName: 'virtual machine',
                            transfers: [
                                sshTransfer(
                                    sourceFiles: 'dist/**/*',
                                    removePrefix: 'dist/',
                                    remoteDirectory: '/var/www/html'
                                )
                            ]
                        )
                    ]
                )
            }
    }
    stage('Deploy'){
        steps{
            build job: 'devops-front-deploy', parameters: [
                string(name: 'GIT_BRANCH', value: "${GIT_BRANCH}"),
                string(name: 'BUILD_NUMBER', value: "${BUILD_NUMBER}")
            ]
        }
    }
    }
}